<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sovannarot Math</title>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      @font-face {
        font-family: "Khmer";
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://raw.githubusercontent.com/sovannarot/learn/main/assets/font/khmer1.woff2)
          format("woff2");
        unicode-range: U+1780-17FF, U+19E0-19FF, U+200C-200D, U+25CC,
          U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,
          U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191,
          U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
      body {
        background: white;
        font-family: "Khmer", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        gap: 10px;
      }
      button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: larger;
      }
    </style>
  </head>
  <body>
    <div id="problem"></div>
    <input type="text" id="input" />
    <div style="display: flex; gap: 10px">
      <button onclick="input.value += 'π'">\(\pi\)</button>
      <button onclick="input.value += 'α'">\(\alpha\)</button>
      <button onclick="input.value += 'β'">\(\beta\)</button>
      <button onclick="input.value += 'γ'">\(\gamma\)</button>
      <button onclick="input.value += 'θ'">\(\theta\)</button>
    </div>
    <button id="generate" type="submit">បង្កើត</button>
    <button id="clear">លុប</button>
    <button id="clearth">លុបទី</button>
    <script>
      const input = document.getElementById("input");
      const generate = document.getElementById("generate");
      const clear = document.getElementById("clear");
      const clearth = document.getElementById("clearth");
      const problem = document.getElementById("problem");
      let problemNumber = 0;
      generate.addEventListener("click", () => {
        if (input.value === "") {
          alert("សូមបញ្ចូលលេខត្រឹមត្រូវ!");
          return;
        }
        const h2 = document.createElement("h2");
        h2.textContent = `\\[${input.value}\\]`;
        h2.className = `problem${problemNumber + 1} problem`;
        problem.appendChild(h2);
        MathJax.typesetPromise();
        problemNumber++;
        input.value = "";
      });
      clear.addEventListener("click", () => {
        const h2 = document.querySelectorAll(".problem");
        h2[h2.length - 1].remove();
        problemNumber--;
      });
      function clearthfun(number) {
        const h2 = document.querySelectorAll(".problem");
        h2[number - 1].remove();
        h2.forEach((h2, index) => {
          h2.className = `problem${index + 1} problem`;
        });
        problemNumber--;
      }
      clearth.addEventListener("click", () => {
        let number = prompt("Enter the number");
        const h2 = document.querySelectorAll(".problem");
        h2[number - 1].remove();
        h2.forEach((h2, index) => {
          h2.className = `problem${index + 1} problem`;
        });
        problemNumber--;
      });
      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        // Enter: Generate (when input is focused)
        if (e.key === "Enter" && document.activeElement === input) {
          generate.click();
          e.preventDefault();
        }
        // Ctrl+Backspace: Remove latest
        if (e.ctrlKey && !e.shiftKey && e.key === "Backspace") {
          clear.click();
          e.preventDefault();
        }
        // Ctrl+Shift+Backspace: Clear by number
        if (e.ctrlKey && e.shiftKey && e.key === "Backspace" && e.key !== "") {
          clearth.click();
          e.preventDefault();
        }
        // Alt+P/A/B/G/T: Insert π, α, β, γ, θ
        if (e.altKey && !e.ctrlKey && !e.shiftKey) {
          let char = null;
          switch (e.key.toLowerCase()) {
            case "p":
              char = "π";
              break;
            case "a":
              char = "α";
              break;
            case "b":
              char = "β";
              break;
            case "g":
              char = "γ";
              break;
            case "t":
              char = "θ";
              break;
          }
          if (char) {
            // Insert at cursor position
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const value = input.value;
            input.value = value.slice(0, start) + char + value.slice(end);
            input.selectionStart = input.selectionEnd = start + 1;
            input.focus();
            e.preventDefault();
          }
        }
      });
    </script>
  </body>
</html>

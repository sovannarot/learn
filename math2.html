<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sovannarot Math</title>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      @font-face {
        font-family: "Khmer";
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://raw.githubusercontent.com/sovannarot/learn/main/assets/font/khmer1.woff2)
          format("woff2");
        unicode-range: U+1780-17FF, U+19E0-19FF, U+200C-200D, U+25CC,
          U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,
          U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191,
          U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
      body {
        background: white;
        font-family: "Khmer", sans-serif;
      }
    </style>
  </head>
  <body>
    <div
      style="
        width: 100vw;
        height: 100svh;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 20px;
      "
    >
      <h2>លំហាត់ត្រីកោណមាត្រ</h2>
      <h2 id="problem"></h2>
      <button
        id="generate"
        style="
          background: blue;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: larger;
        "
      >
        បង្កើតលំហាត់
      </button>
      <h2 id="answer"></h2>
      <button
        id="answer-button"
        style="
          background: blue;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: larger;
        "
      >
        ចម្លើយ
      </button>
    </div>
    <div
      id="calculator"
      style="width: 600px; height: 400px; margin: auto"
    ></div>
    <script>
      let answer;
      document.getElementById("generate").addEventListener("click", () => {
        if (answer) {
          answer = undefined;
          document.getElementById("answer").innerHTML = "";
        } 
        const denominator = [2, 3, 4, 6];
        const randomIndex = Math.floor(Math.random() * 4);
        const coefficient = Math.floor(Math.random() * 40) + 1;
        const remainder = [];
        for (let i = 1; i < denominator[randomIndex]; i++) {
          if (
            denominator[randomIndex] === 2 &&
            (coefficient * 2 + i) % 2 !== 0
          ) {
            remainder.push(i);
          } else if (
            denominator[randomIndex] === 3 &&
            (coefficient * 3 + i) % 3 !== 0
          ) {
            remainder.push(i);
          } else if (
            denominator[randomIndex] === 4 &&
            (coefficient * 4 + i) % 2 !== 0
          ) {
            remainder.push(i);
          } else if (
            denominator[randomIndex] === 6 &&
            (coefficient * 6 + i) % 2 !== 0 &&
            (coefficient * 6 + i) % 3 !== 0
          ) {
            remainder.push(i);
          }
        }
        const randomRemainder = Math.floor(Math.random() * remainder.length);
        const numerator =
          coefficient * denominator[randomIndex] + remainder[randomRemainder];
        const randomOperation = Math.floor(Math.random() * 2) === 0;
        if (remainder.length === 0) {
          document.getElementById("problem").innerHTML = randomOperation
            ? `\\[\\sin (${coefficient}π)\\]`
            : `\\[\\cos (${coefficient}π)\\]`;
          MathJax.typesetPromise();
          answer = randomOperation
            ? Math.sin(coefficient * Math.PI)
            : Math.cos(coefficient * Math.PI);
        } else {
          document.getElementById("problem").innerHTML = randomOperation
            ? `\\[\\sin (\\frac{${numerator}π}{${denominator[randomIndex]}})\\]`
            : `\\[\\cos (\\frac{${numerator}π}{${denominator[randomIndex]}})\\]`;
          MathJax.typesetPromise();
          answer = randomOperation
            ? Math.sin((numerator / denominator[randomIndex]) * Math.PI)
            : Math.cos((numerator / denominator[randomIndex]) * Math.PI);
        }
      });
      document.getElementById("answer-button").addEventListener("click", () => {
        let fraction;
        let absAnswer = Math.abs(answer).toFixed(6);
        if (answer < 0) {
          if (absAnswer === "0.707107") {
            fraction = `\\[-\\frac{\\sqrt{2}}{2}\\]`;
          } else if (absAnswer == "0.500000") {
            fraction = `\\[-\\frac{1}{2}\\]`;
          } else if (absAnswer == "1.000000") {
            fraction = `\\[-1\\]`;
          } else if (absAnswer == "0.866025") {
            fraction = `\\[-\\frac{\\sqrt{3}}{2}\\]`;
          } else if (absAnswer == "0.000000") {
            fraction = `\\[0\\]`;
          }
        } else {
          if (absAnswer === "0.707107") {
            fraction = `\\[\\frac{\\sqrt{2}}{2}\\]`;
          } else if (absAnswer == "0.500000") {
            fraction = `\\[\\frac{1}{2}\\]`;
          } else if (absAnswer == "1.000000") {
            fraction = `\\[1\\]`;
          } else if (absAnswer == "0.866025") {
            fraction = `\\[\\frac{\\sqrt{3}}{2}\\]`;
          } else if (absAnswer == "0.000000") {
            fraction = `\\[0\\]`;
          }
        }
        document.getElementById("answer").innerHTML = fraction;
        MathJax.typesetPromise();
      });
    </script>
  </body>
</html>
